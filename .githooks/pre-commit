#!/bin/sh
# Pre-commit hook for tdata-rs
# Mirrors all CI checks to catch issues BEFORE push

set -e

echo "üîç Running pre-commit checks (mirrors CI)..."

# Format check
echo "  üìù [1/5] Checking formatting..."
cargo fmt --check

# Clippy
echo "  üîé [2/5] Running clippy..."
cargo clippy --all-features -- -D warnings

# Tests
echo "  üß™ [3/5] Running tests..."
cargo test --quiet

# Docs (catches doc warnings)
echo "  üìö [4/5] Building docs..."
RUSTDOCFLAGS="-Dwarnings" cargo doc --no-deps --all-features --quiet

# MSRV check (requires rustup)
echo "  üîß [5/5] Checking MSRV (1.82.0)..."
if command -v rustup >/dev/null 2>&1; then
    if rustup run 1.82.0 cargo check --all-features --quiet 2>/dev/null; then
        echo "       MSRV 1.82.0 ‚úì"
    else
        echo "       ‚ö†Ô∏è  MSRV 1.82.0 not installed, skipping"
    fi
else
    echo "       ‚ö†Ô∏è  rustup not found, skipping MSRV check"
fi

echo "‚úÖ All pre-commit checks passed!"
